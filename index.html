<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>jsGoniometer by DrSnuggles</title>
  <script src="//cdn.jsdelivr.net/gh/wothke/webaudio-player/htdocs_example/stdlib/scriptprocessor_player.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/wothke/webAyumi/htdocs/backend_ayumi.js"></script>
  <script src="goniometer.js"></script>
  <style>
    #vectorcanvas {
      position: absolute;
      left: 0;
      width: 100vw;
      bottom: 0;
      height: 90vh;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <button onclick="start()">Start</button>&nbsp;
  <button onclick="stop()">Stop</button>&nbsp;
  FFT: <select id="fftSize" onchange="change_fftSize(this.value);">
    <option value="32">32</option>
    <option value="64">64</option>
    <option value="128">128</option>
    <option value="256">256</option>
    <option value="512">512</option>
    <option value="1024">1024</option>
    <option value="2048" selected>2048</option>
    <option value="4096">4096</option>
    <option value="8192">8192</option>
    <option value="16384">16384</option>
    <option value="32768">32768</option>
  </select>&nbsp;
  Opacity <span id="actOpa">1.00</span>: <input type="range" min="0" max="1" value="1.00" step="0.01" onchange="change_opacity(this.value);"/>

  <canvas id="vectorcanvas"></canvas>

  <script>
    // start music, doesn't matter if enableSpectrum is true or false
    ScriptNodePlayer.createInstance(new AyumiBackendAdapter(), "", [], false, function(){}, function(){}, function(){ScriptNodePlayer.getInstance().loadMusicDataFromCache("audio/01_scalesmannmisfire.fym", {}, function(){});}); // backendAdapter, basePath, requiredFiles, enableSpectrum, onPlayerReady, onTrackReadyToPlay, onTrackEnd, doOnUpdate, externalTicker
    ScriptNodePlayer.getInstance().loadMusicFromURL("audio/01_scalesmannmisfire.fym", {}, function(){}, function(){}, function(){}); // url, options, onCompletion, onFail, onProgress
    //ScriptNodePlayer.createInstance(new AyumiBackendAdapter(), "", [], false, function(){}, function(){}, function(){ScriptNodePlayer.getInstance().loadMusicDataFromCache("//modland.com/pub/modules/YM/Jochen%20Hippel/rings%20of%20medusa%20-%20in-game.ym", {}, function(){});}); // backendAdapter, basePath, requiredFiles, enableSpectrum, onPlayerReady, onTrackReadyToPlay, onTrackEnd, doOnUpdate, externalTicker
    //ScriptNodePlayer.getInstance().loadMusicFromURL("//modland.com/pub/modules/YM/Jochen%20Hippel/rings%20of%20medusa%20-%20in-game.ym", {}, function(){}, function(){}, function(){}); // url, options, onCompletion, onFail, onProgress

    function start() {
      Goniometer.start(ScriptNodePlayer.getInstance()._gainNode, vectorcanvas);
    }

    function stop() {
      Goniometer.stop();
    }

    function change_fftSize(newSize) {
      Goniometer.setFFTsize(newSize);
    }

    function change_opacity(newOpa) {
      Goniometer.bgColor = [Goniometer.bgColor[0], Goniometer.bgColor[1], Goniometer.bgColor[2], newOpa];
      actOpa.innerText = (newOpa*1).toFixed(2);
    }
  </script>

</body>
</html>
